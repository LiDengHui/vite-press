# è·¨æ ‡ç­¾é¡µé€šä¿¡

## Broadcast Channel API

```js
// æ‰€æœ‰æ ‡ç­¾é¡µåŠ å…¥åŒä¸€ä¸ª"é¢‘é“"
const channel = new BroadcastChannel('shop_channel');

// æ ‡ç­¾1å‘é€æ¶ˆæ¯
channel.postMessage({action: 'addToCart', item: 'å¯çˆ±çŒ«çŒ«'});

// æ ‡ç­¾2æ¥æ”¶æ¶ˆæ¯
channel.onmessage = (event) => {
    console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
    // æ˜¾ç¤ºï¼š"æ”¶åˆ°æ¶ˆæ¯: {action: "addToCart", item: "å¯çˆ±çŒ«çŒ«"}"
};


```

å°±åƒä¸€ç¾¤äººåœ¨åŒä¸€ä¸ªå¯¹è®²æœºé¢‘é“èŠå¤©
ç°ä»£æµè§ˆå™¨éƒ½æ”¯æŒï¼ˆIEé™¤å¤–ğŸ˜…ï¼‰
é€‚åˆé¢‘ç¹é€šä¿¡

## Service Worker

```js

// service-worker.js
self.addEventListener('message', (event) => {
    // å‘Šè¯‰æ‰€æœ‰æ ‡ç­¾é¡µ
    self.clients.matchAll().then(clients => {
        clients.forEach(client => client.postMessage(event.data));
    });
});

// æ ‡ç­¾é¡µä»£ç 
navigator.serviceWorker.onmessage = (event) => {
    console.log('é‚®å·®é€æ¥æ¶ˆæ¯:', event.data);
};

// å‘é€æ¶ˆæ¯
navigator.serviceWorker.controller.postMessage('å¿«é€’åˆ°å•¦ï¼');

```

PWAåº”ç”¨ï¼ˆæ¯”å¦‚ç¦»çº¿å¯ç”¨çš„ç½‘é¡µï¼‰
éœ€è¦åå°åŒæ­¥çš„åœºæ™¯

## LocalStorage

```js

// æ ‡ç­¾1å†™ä¸‹ç•™è¨€
localStorage.setItem('message', 'ä»Šæ™šåƒç«é”…ï¼');

// æ ‡ç­¾2ç›‘å¬å°æœ¬æœ¬å˜åŒ–
window.addEventListener('storage', (event) => {
    if (event.key === 'message') {
        console.log('æ–°ç•™è¨€:', event.newValue);
    }
});

```

å½“å‰æ ‡ç­¾é¡µä¿®æ”¹ä¸ä¼šè§¦å‘è‡ªå·±çš„ç›‘å¬
å®¹é‡çº¦5MBï¼ˆèƒ½å†™å¾ˆå¤šå°çº¸æ¡å•¦ï¼‰

## Shaded Worker

```js
const ports = []; // è¿æ¥çš„æ‰€æœ‰æ ‡ç­¾é¡µ

onconnect = (e) => {
    const port = e.ports[0];
    ports.push(port);

    port.onmessage = (event) => {
        // å¹¿æ’­ç»™å…¶ä»–åŒäº‹
        ports.forEach(p => p !== port && p.postMessage(event.data));
    };
};

// æ ‡ç­¾é¡µä»£ç 
const worker = new SharedWorker('shared-worker.js');
worker.port.onmessage = (event) => {
    console.log('åŠå…¬å®¤é€šçŸ¥:', event.data);
};
worker.port.postMessage('å¤§å®¶å¥½å‘€ï¼');

```

## è½®è¯¢æ‰«æ IndexedDB/Cookie

```js
// æ–¹æ¡ˆ5ï¼šIndexedDBè½®è¯¢
setInterval(() => {
    db.get('message').then(val => {
        if (val !== lastMessage) {
            console.log('å‘ç°æ–°æ¶ˆæ¯:', val);
            lastMessage = val;
        }
    });
}, 1000);

// æ–¹æ¡ˆ6ï¼šCookieè½®è¯¢
setInterval(() => {
    const msg = getCookie('message');
    if (msg !== lastMsg) {
        console.log('Cookieæ¶ˆæ¯:', msg);
        lastMsg = msg;
    }
}, 1000);

```

## window.open çˆ¶å­çª—å£å¯¹è¯

```js
// çˆ¶çª—å£
const child = window.open('child.html');
child.postMessage('ä¹–å„¿å­', 'https://same-origin.com');

// å­çª—å£
window.opener.postMessage('è€çˆ¸å¥½ï¼', 'https://same-origin.com');

// ä¸¤è¾¹éƒ½è¦ç›‘å¬
window.addEventListener('message', (event) => {
    if (event.origin !== 'https://same-origin.com') return;
    console.log('æ”¶åˆ°:', event.data);
});

```

å¿…é¡»éªŒè¯ event.origin

åªèƒ½æ¥æ”¶è®¤è¯†çš„äººçš„ä¿¡æ¯

## WebSocket

```js
// æ‰€æœ‰æ ‡ç­¾é¡µè¿æ¥åŒä¸€ä¸ªWebSocket
const socket = new WebSocket('wss://example.com/chat');

socket.onmessage = (event) => {
    console.log('æœåŠ¡å™¨é€šçŸ¥:', event.data);
};

// å‘é€æ¶ˆæ¯
socket.send('æ ‡ç­¾1å‘æ¥çš„æ¶ˆæ¯');

```

å®æ—¶æ€§æœ€å¼º
é€‚åˆéœ€è¦æœåŠ¡å™¨å‚ä¸çš„å¤æ‚åœºæ™¯

## SharedArrayBuffer

```js
// ä¸»çº¿ç¨‹
const buffer = new SharedArrayBuffer(1024);
const arr = new Int32Array(buffer);

// å¯ä»¥ä¼ é€’ç»™Worker
worker.postMessage({buffer});

// Workerä¸­ä¿®æ”¹
Atomics.store(arr, 0, 123); // çº¿ç¨‹å®‰å…¨å†™å…¥

```

éœ€è¦è®¾ç½®å®‰å…¨å“åº”å¤´
é€‚åˆé«˜æ€§èƒ½è®¡ç®—

## æ€»ç»“

| **æ–¹æ¡ˆ**             | **é€‚åˆåœºæ™¯** | **éš¾åº¦** | **å®æ—¶æ€§** | **è®°å¿†å£è¯€** |
|--------------------|----------|--------|---------|----------|
| BroadcastChannel   | ç®€å•ç°ä»£åº”ç”¨   | â­â­     | â­â­â­â­    | "å¯¹è®²æœºèŠå¤©"  |
| LocalStorage       | å°‘é‡æ•°æ®åŒæ­¥   | â­      | â­â­â­     | "å…±äº«å°æœ¬æœ¬"  |
| SharedWorker       | å¤æ‚æ•°æ®å…±äº«   | â­â­â­    | â­â­â­â­â­â­  | "å…±äº«åŠå…¬å®¤"  |
| Service Worker     | PWA/ç¦»çº¿åº”ç”¨ | â­â­â­â­   | â­â­â­â­â­   | "éšå½¢é‚®å·®"   |
| WebSocket          | éœ€è¦æœåŠ¡å™¨å‚ä¸  | â­â­â­â­â­  | â­â­â­â­â­   | "ä¸“ä¸šç”µè¯çº¿"  |
| window.postMessage | ç‰¹å®šçª—å£é€šä¿¡   | â­â­â­â­   | â­â­â­â­â­   | "çˆ¶å­æ‚„æ‚„è¯"  |
